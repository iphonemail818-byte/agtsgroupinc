<script>
document.addEventListener("DOMContentLoaded", ()=>{

  const f = id => document.getElementById(id);
  const showField = id => f(id).classList.add("show");

  // Progressive reveal
  f("pickup").addEventListener("input", checkProgressive);
  f("dropoff").addEventListener("input", checkProgressive);
  f("pickupDate").addEventListener("change", checkProgressive);
  f("pickupTime").addEventListener("change", checkProgressive);
  f("vehicle").addEventListener("change", checkProgressive);
  f("passengers").addEventListener("change", checkProgressive);
  f("pets").addEventListener("change", checkProgressive);
  f("name").addEventListener("input", checkProgressive);
  f("phone").addEventListener("input", checkProgressive);
  f("email").addEventListener("input", checkProgressive);

  function checkProgressive(){
    if(f("pickup").value.trim() && f("dropoff").value.trim()) showField("dateField");
    if(f("pickupDate").value) showField("timeField");
    if(f("pickupTime").value){
      showField("vehicleField");
      showField("passengersField");
      showField("petsField");
    }
    if(f("pets").value){
      showField("nameField");
      showField("phoneField");
      showField("emailField");
      f("payBtn").classList.add("show");
    }
    checkAllFields();
  }

  // Fields for validation
  const fields = [
    f("pickup"), f("dropoff"), f("pickupDate"), f("pickupTime"),
    f("vehicle"), f("passengers"), f("pets"), f("name"), f("phone"), f("email")
  ];

  // Validation and red glow
  function validateFields(){
    let ok = true;
    fields.forEach(el=>{
      el.classList.remove("input-error");
      if(!el.value.trim()){
        el.classList.add("input-error");
        ok = false;
      }
    });
    return ok;
  }

  // Render summary
  function renderSummary(){
    f("sumPickup").textContent = "Pickup: " + f("pickup").value;
    f("sumDropoff").textContent = "Drop-off: " + f("dropoff").value;
    f("sumDateTime").textContent = "Date & Time: " + f("pickupDate").value + " at " + f("pickupTime").value;
    f("sumVehicle").textContent = "Vehicle: " + f("vehicle").value +
      " | Passengers: " + f("passengers").value + " | Pets: " + f("pets").value;
    f("tripSummary").classList.add("show");
  }

  // Check if all mandatory fields are filled
  function checkAllFields(){
    let allFilled = fields.every(el => el.value.trim());
    if(allFilled){
      renderSummary(); // automatically update summary
    }
  }

  // Book & Pay button
  f("payBtn").addEventListener("click", ()=>{
    if(!validateFields()) return; // mandatory check
    alert("Booking submitted successfully!");
  });

  // Google Autocomplete
  window.initAutocomplete = function(){
    new google.maps.places.Autocomplete(f("pickup"));
    new google.maps.places.Autocomplete(f("dropoff"));
  };

});
</script>
