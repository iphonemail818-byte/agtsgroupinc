<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium SUV Service</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Full-screen background - MAXIMUM VISIBILITY */
        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .background-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.85); /* Bright background */
        }

        /* Main container */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 24px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Floating booking card - VERY TRANSPARENT */
        .booking-container {
            background: rgba(0, 0, 0, 0.1); /* Almost completely transparent */
            backdrop-filter: blur(8px); /* Very subtle blur */
            border-radius: 24px;
            padding: 28px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            margin-top: 40px;
        }

        /* Form elements with glass effect */
        .form-group {
            margin-bottom: 28px;
            position: relative;
        }

        .input-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #ffffff;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .input-wrapper {
            position: relative;
        }

        .input-field {
            width: 100%;
            padding: 20px 60px 20px 20px;
            font-size: 17px;
            background: rgba(255, 255, 255, 0.12);
            border: 1.5px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            color: #ffffff;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            -webkit-appearance: none;
            font-weight: 500;
        }

        .input-field:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.18);
            box-shadow: 
                0 0 0 3px rgba(255, 255, 255, 0.1),
                0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
            font-weight: 400;
        }

        /* Location icon for pickup */
        .location-icon-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .location-icon-btn:hover .location-icon {
            transform: scale(1.1);
        }

        .location-icon {
            width: 22px;
            height: 22px;
            fill: rgba(255, 255, 255, 0.9);
            transition: all 0.2s ease;
        }

        /* Plus icon for destination */
        .add-stop-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .add-stop-btn:hover .plus-icon {
            transform: scale(1.1);
        }

        .plus-icon {
            width: 22px;
            height: 22px;
            fill: rgba(255, 255, 255, 0.9);
            transition: all 0.2s ease;
        }

        /* Stop fields container */
        .stops-container {
            margin-top: 10px;
        }

        .stop-field {
            margin-bottom: 12px;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .remove-stop-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 26px;
            height: 26px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            color: #ffffff;
            font-size: 18px;
            font-weight: 300;
            transition: all 0.2s ease;
        }

        .remove-stop-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        /* Summary items - subtle */
        .summary-container {
            margin-top: 8px;
        }

        .summary-item {
            padding: 16px 20px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            border-left: 3px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(4px);
        }

        .summary-item:hover {
            background: rgba(255, 255, 255, 0.12);
            border-left-color: rgba(255, 255, 255, 0.4);
        }

        .summary-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 6px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .summary-value {
            font-size: 16px;
            color: #ffffff;
            font-weight: 500;
        }

        /* DateTime inputs */
        .datetime-row {
            display: flex;
            gap: 15px;
        }

        .datetime-group {
            flex: 1;
        }

        /* Action buttons - glass effect */
        .action-buttons {
            margin-top: auto;
            padding-top: 30px;
        }

        .btn {
            width: 100%;
            padding: 22px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.95);
            color: #0a0a0a;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-primary:hover {
            background: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.25);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            color: #ffffff;
            margin-top: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Autocomplete dropdown - glass effect */
        .pac-container {
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            margin-top: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            font-family: 'Inter', sans-serif;
            backdrop-filter: blur(10px);
        }

        .pac-item {
            padding: 14px 20px;
            color: #e0e0e0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 15px;
            cursor: pointer;
        }

        .pac-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .pac-item-selected {
            background: rgba(255, 255, 255, 0.15);
        }

        .pac-icon {
            margin-right: 12px;
        }

        .pac-item-query {
            color: #ffffff;
            font-size: 15px;
        }

        /* Utility classes */
        .hidden {
            display: none;
        }

        .step-indicator {
            text-align: center;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 25px;
            letter-spacing: 1px;
            margin-top: 20px;
            text-transform: uppercase;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .container {
                padding: 20px 16px;
            }
            
            .booking-container {
                padding: 24px;
                background: rgba(0, 0, 0, 0.08);
                margin-top: 30px;
                border-radius: 20px;
            }
            
            .input-field {
                padding: 18px 55px 18px 16px;
                font-size: 16px;
                border-radius: 14px;
            }
            
            .datetime-row {
                flex-direction: column;
                gap: 12px;
            }
            
            .location-icon, .plus-icon {
                width: 20px;
                height: 20px;
            }
            
            .btn {
                padding: 20px;
                border-radius: 14px;
            }
        }

        @media (max-height: 700px) {
            .container {
                padding-top: 15px;
            }
            
            .booking-container {
                margin-top: 20px;
            }
            
            .form-group {
                margin-bottom: 22px;
            }
            
            .input-field {
                padding: 16px 55px 16px 16px;
            }
        }

        /* Loading state */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        /* Modal styling - glass effect */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: rgba(20, 20, 20, 0.95);
            border-radius: 24px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
        }
        
        .modal-header {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 25px;
            color: #ffffff;
            text-align: center;
        }
        
        .modal-details {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-detail-row {
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-detail-row:last-child {
            border-bottom: none;
        }
        
        .modal-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
            letter-spacing: 0.5px;
        }
        
        .modal-value {
            font-size: 16px;
            color: #ffffff;
            font-weight: 500;
        }
        
        /* Floating hint */
        .hint {
            text-align: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 15px;
            font-weight: 400;
        }
        
        /* Subtle focus indicator */
        .focus-ring {
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 19px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .input-wrapper:focus-within .focus-ring {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Background Image - MAXIMUM VISIBILITY -->
    <div class="background-container">
        <img src="https://raw.githubusercontent.com/iphonemail818-byte/agtsgroupinc/main/IMG_6201.png" alt="Premium SUV Background">
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- REMOVED HEADER -->

        <div class="step-indicator">Book Your Premium Journey</div>

        <div class="booking-container">
            <!-- Pickup Location -->
            <div class="form-group">
                <label class="input-label">Pickup Location</label>
                <div class="input-wrapper">
                    <div class="focus-ring"></div>
                    <input type="text" 
                           id="pickup-input" 
                           class="input-field" 
                           placeholder="Current location or enter address"
                           autocomplete="off">
                    <button type="button" class="location-icon-btn" id="current-location-btn" title="Use current location">
                        <svg class="location-icon" viewBox="0 0 24 24">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                    </button>
                </div>
                <div class="summary-container" id="pickup-summary"></div>
            </div>

            <!-- Destination -->
            <div class="form-group">
                <label class="input-label">Destination</label>
                <div class="input-wrapper">
                    <div class="focus-ring"></div>
                    <input type="text" 
                           id="destination-input" 
                           class="input-field" 
                           placeholder="Enter destination address"
                           autocomplete="off">
                    <button type="button" class="add-stop-btn" id="add-stop-btn" title="Add a stop">
                        <svg class="plus-icon" viewBox="0 0 24 24">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                    </button>
                </div>
                <div class="summary-container" id="destination-summary"></div>
            </div>

            <!-- Stops Container (initially hidden) -->
            <div class="stops-container" id="stops-container"></div>

            <!-- Date & Time -->
            <div class="form-group">
                <label class="input-label">Date & Time</label>
                <div class="datetime-row">
                    <div class="datetime-group">
                        <div class="input-wrapper">
                            <div class="focus-ring"></div>
                            <input type="date" 
                                   id="date-input" 
                                   class="input-field">
                        </div>
                    </div>
                    <div class="datetime-group">
                        <div class="input-wrapper">
                            <div class="focus-ring"></div>
                            <input type="time" 
                                   id="time-input" 
                                   class="input-field">
                        </div>
                    </div>
                </div>
                <div class="summary-container" id="datetime-summary"></div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button type="button" class="btn btn-primary" id="review-btn">
                    Review Trip
                </button>
                <button type="button" class="btn btn-secondary hidden" id="edit-trip-btn">
                    Edit Trip Details
                </button>
            </div>
            
            <div class="hint">Tap any summary to edit</div>
        </div>
    </div>

    <script>
        // Google Maps API Key
        const GOOGLE_MAPS_API_KEY = 'AIzaSyBiBOnLypU6-YGgPruQ2YFZvk3HyaaQ5Ps';
        
        // State management
        const state = {
            pickup: '',
            destination: '',
            stops: [], // Changed to array
            date: '',
            time: '',
            stopCount: 0
        };

        // DOM Elements
        const elements = {
            pickupInput: document.getElementById('pickup-input'),
            destinationInput: document.getElementById('destination-input'),
            dateInput: document.getElementById('date-input'),
            timeInput: document.getElementById('time-input'),
            currentLocationBtn: document.getElementById('current-location-btn'),
            addStopBtn: document.getElementById('add-stop-btn'),
            stopsContainer: document.getElementById('stops-container'),
            reviewBtn: document.getElementById('review-btn'),
            editTripBtn: document.getElementById('edit-trip-btn'),
            summaryContainers: {
                pickup: document.getElementById('pickup-summary'),
                destination: document.getElementById('destination-summary'),
                datetime: document.getElementById('datetime-summary')
            }
        };

        // Initialize date and time with default values
        function initializeDateTime() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            // Format date as YYYY-MM-DD
            const formattedDate = tomorrow.toISOString().split('T')[0];
            
            // Set default time to next hour
            const nextHour = (now.getHours() + 1) % 24;
            const formattedTime = `${nextHour.toString().padStart(2, '0')}:00`;
            
            elements.dateInput.value = formattedDate;
            elements.timeInput.value = formattedTime;
            
            state.date = formattedDate;
            state.time = formattedTime;
            updateDateTimeSummary();
        }

        // Update summary display
        function updateSummary(field) {
            const container = elements.summaryContainers[field];
            if (!container) return;

            let value = state[field];
            let label = '';

            switch(field) {
                case 'pickup':
                    label = 'Pickup';
                    value = value || 'Current location';
                    break;
                case 'destination':
                    label = 'Destination';
                    break;
                case 'datetime':
                    label = 'Date & Time';
                    if (state.date && state.time) {
                        const dateObj = new Date(state.date + 'T' + state.time);
                        value = dateObj.toLocaleString('en-US', {
                            weekday: 'short',
                            month: 'short',
                            day: 'numeric',
                            hour: 'numeric',
                            minute: '2-digit'
                        });
                    }
                    break;
            }

            if (value) {
                container.innerHTML = `
                    <div class="summary-item" data-edit-field="${field}">
                        <div class="summary-label">${label}</div>
                        <div class="summary-value">${value}</div>
                    </div>
                `;
                
                // Add edit handler
                const summaryItem = container.querySelector('.summary-item');
                summaryItem.addEventListener('click', () => editField(field));
                
                // Hide input if field is completed
                if (field !== 'datetime') {
                    document.getElementById(`${field}-input`).classList.add('hidden');
                } else {
                    elements.dateInput.classList.add('hidden');
                    elements.timeInput.classList.add('hidden');
                }
            }
        }

        // Create stop input field
        function createStopField(index, value = '') {
            const stopId = `stop-${index}`;
            const stopField = document.createElement('div');
            stopField.className = 'stop-field';
            stopField.innerHTML = `
                <div class="input-wrapper">
                    <div class="focus-ring"></div>
                    <input type="text" 
                           id="${stopId}" 
                           class="input-field stop-input" 
                           placeholder="Enter stop address"
                           autocomplete="off"
                           value="${value}">
                    <button type="button" class="remove-stop-btn" data-stop-id="${stopId}">
                        Ã—
                    </button>
                </div>
            `;
            
            // Initialize autocomplete for this stop
            setTimeout(() => initAutocompleteForStop(stopId), 100);
            
            return stopField;
        }

        // Initialize autocomplete for a stop field
        function initAutocompleteForStop(inputId) {
            const input = document.getElementById(inputId);
            if (!input || !window.google || !window.google.maps || !window.google.maps.places) return;
            
            const autocomplete = new google.maps.places.Autocomplete(
                input,
                {
                    types: ['address'],
                    componentRestrictions: { country: 'us' }
                }
            );
            
            autocomplete.addListener('place_changed', () => {
                const place = autocomplete.getPlace();
                if (place.formatted_address) {
                    const stopIndex = parseInt(inputId.split('-')[1]);
                    state.stops[stopIndex] = place.formatted_address;
                }
            });
            
            // Handle manual input
            input.addEventListener('blur', () => {
                if (input.value.trim()) {
                    const stopIndex = parseInt(inputId.split('-')[1]);
                    state.stops[stopIndex] = input.value;
                }
            });
        }

        // Add a new stop
        elements.addStopBtn.addEventListener('click', () => {
            const stopIndex = state.stopCount;
            state.stops.push('');
            
            const stopField = createStopField(stopIndex);
            elements.stopsContainer.appendChild(stopField);
            
            // Focus on the new stop input
            const stopInput = document.getElementById(`stop-${stopIndex}`);
            setTimeout(() => stopInput.focus(), 100);
            
            state.stopCount++;
            
            // Update summary for stops if needed
            updateStopsSummary();
        });

        // Remove a stop
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-stop-btn')) {
                const stopId = e.target.getAttribute('data-stop-id');
                const stopIndex = parseInt(stopId.split('-')[1]);
                
                // Remove from state
                state.stops.splice(stopIndex, 1);
                
                // Re-index remaining stops
                state.stops = state.stops.filter((_, index) => true); // Keep all
                
                // Remove from DOM
                const stopField = e.target.closest('.stop-field');
                if (stopField) {
                    stopField.remove();
                }
                
                // Update stop IDs and reinitialize autocomplete
                updateStopFields();
                updateStopsSummary();
            }
        });

        // Update stop fields after removal
        function updateStopFields() {
            const stopInputs = document.querySelectorAll('.stop-input');
            stopInputs.forEach((input, index) => {
                const newId = `stop-${index}`;
                input.id = newId;
                input.parentElement.querySelector('.remove-stop-btn').setAttribute('data-stop-id', newId);
                
                // Reinitialize autocomplete
                initAutocompleteForStop(newId);
            });
            
            state.stopCount = stopInputs.length;
        }

        // Update stops summary
        function updateStopsSummary() {
            // We'll handle stops in the review modal
        }

        // Edit field
        function editField(field) {
            // Show input
            if (field === 'datetime') {
                elements.dateInput.classList.remove('hidden');
                elements.timeInput.classList.remove('hidden');
            } else {
                const input = document.getElementById(`${field}-input`);
                input.classList.remove('hidden');
                input.focus();
                
                // Show location icon button only for pickup
                if (field === 'pickup') {
                    document.querySelector('.location-icon-btn').classList.remove('hidden');
                } else if (field === 'destination') {
                    document.querySelector('.add-stop-btn').classList.remove('hidden');
                }
            }
            
            // Clear summary
            elements.summaryContainers[field].innerHTML = '';
        }

        // Update all summaries
        function updateDateTimeSummary() {
            updateSummary('datetime');
        }

        // Initialize Google Maps Autocomplete
        function initAutocomplete() {
            if (!window.google || !window.google.maps || !window.google.maps.places) {
                // Load Google Maps API
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places&callback=initAutocompleteCallback`;
                script.async = true;
                script.defer = true;
                document.head.appendChild(script);
                return;
            }

            // Create autocomplete for pickup
            const pickupAutocomplete = new google.maps.places.Autocomplete(
                elements.pickupInput,
                {
                    types: ['address'],
                    componentRestrictions: { country: 'us' }
                }
            );

            // Create autocomplete for destination
            const destinationAutocomplete = new google.maps.places.Autocomplete(
                elements.destinationInput,
                {
                    types: ['address'],
                    componentRestrictions: { country: 'us' }
                }
            );

            // Add place change listeners
            pickupAutocomplete.addListener('place_changed', () => {
                const place = pickupAutocomplete.getPlace();
                if (place.formatted_address) {
                    state.pickup = place.formatted_address;
                    updateSummary('pickup');
                    elements.destinationInput.focus();
                }
            });

            destinationAutocomplete.addListener('place_changed', () => {
                const place = destinationAutocomplete.getPlace();
                if (place.formatted_address) {
                    state.destination = place.formatted_address;
                    updateSummary('destination');
                }
            });

            // Prevent form submission on enter in autocomplete fields
            [elements.pickupInput, elements.destinationInput].forEach(input => {
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        
                        if (input.value.trim()) {
                            if (input.id === 'pickup-input') {
                                state.pickup = input.value;
                                updateSummary('pickup');
                                elements.destinationInput.focus();
                            } else if (input.id === 'destination-input') {
                                state.destination = input.value;
                                updateSummary('destination');
                            }
                        }
                    }
                });
            });
        }

        // Get current location
        elements.currentLocationBtn.addEventListener('click', () => {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by your browser');
                return;
            }

            // Change icon to loading state
            const locationIcon = elements.currentLocationBtn.querySelector('.location-icon');
            const originalFill = locationIcon.style.fill;
            const originalOpacity = locationIcon.style.opacity;
            locationIcon.style.fill = '#4dabf7';
            locationIcon.style.opacity = '1';

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    
                    // Use Geocoding API to get address
                    fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${latitude},${longitude}&key=${GOOGLE_MAPS_API_KEY}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.results && data.results[0]) {
                                state.pickup = data.results[0].formatted_address;
                                elements.pickupInput.value = data.results[0].formatted_address;
                            } else {
                                state.pickup = `Current Location (${latitude.toFixed(4)}, ${longitude.toFixed(4)})`;
                                elements.pickupInput.value = state.pickup;
                            }
                            updateSummary('pickup');
                            
                            // Reset icon
                            locationIcon.style.fill = originalFill;
                            locationIcon.style.opacity = originalOpacity;
                            
                            elements.destinationInput.focus();
                        })
                        .catch(() => {
                            // Fallback to coordinates if geocoding fails
                            state.pickup = `Current Location (${latitude.toFixed(4)}, ${longitude.toFixed(4)})`;
                            elements.pickupInput.value = state.pickup;
                            updateSummary('pickup');
                            
                            // Reset icon
                            locationIcon.style.fill = originalFill;
                            locationIcon.style.opacity = originalOpacity;
                            
                            elements.destinationInput.focus();
                        });
                },
                (error) => {
                    alert('Unable to retrieve your location. Please enter manually.');
                    // Reset icon
                    locationIcon.style.fill = originalFill;
                    locationIcon.style.opacity = originalOpacity;
                }
            );
        });

        // Handle manual input confirmation
        elements.pickupInput.addEventListener('blur', () => {
            if (elements.pickupInput.value.trim()) {
                state.pickup = elements.pickupInput.value;
                updateSummary('pickup');
            }
        });

        elements.destinationInput.addEventListener('blur', () => {
            if (elements.destinationInput.value.trim()) {
                state.destination = elements.destinationInput.value;
                updateSummary('destination');
            }
        });

        // Handle date/time changes
        elements.dateInput.addEventListener('change', () => {
            state.date = elements.dateInput.value;
            updateDateTimeSummary();
        });

        elements.timeInput.addEventListener('change', () => {
            state.time = elements.timeInput.value;
            updateDateTimeSummary();
        });

        // Review trip
        elements.reviewBtn.addEventListener('click', () => {
            // Validate required fields
            if (!state.pickup) {
                alert('Please enter pickup location');
                editField('pickup');
                return;
            }

            if (!state.destination) {
                alert('Please enter destination');
                editField('destination');
                return;
            }

            // Collect all stops from inputs
            const stopInputs = document.querySelectorAll('.stop-input');
            state.stops = [];
            stopInputs.forEach(input => {
                if (input.value.trim()) {
                    state.stops.push(input.value);
                }
            });

            // Create review modal
            createReviewModal();
        });

        // Create review modal
        function createReviewModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            let stopsHtml = '';
            if (state.stops.length > 0) {
                state.stops.forEach((stop, index) => {
                    stopsHtml += `
                        <div class="modal-detail-row">
                            <div class="modal-label">Stop ${index + 1}</div>
                            <div class="modal-value">${stop}</div>
                        </div>
                    `;
                });
            }
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">Trip Review</div>
                    <div class="modal-details">
                        <div class="modal-detail-row">
                            <div class="modal-label">Pickup</div>
                            <div class="modal-value">${state.pickup}</div>
                        </div>
                        <div class="modal-detail-row">
                            <div class="modal-label">Destination</div>
                            <div class="modal-value">${state.destination}</div>
                        </div>
                        ${stopsHtml}
                        <div class="modal-detail-row">
                            <div class="modal-label">Date & Time</div>
                            <div class="modal-value">${new Date(state.date + 'T' + state.time).toLocaleString('en-US', {
                                weekday: 'short',
                                month: 'short',
                                day: 'numeric',
                                hour: 'numeric',
                                minute: '2-digit'
                            })}</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-primary" id="confirm-booking" style="flex: 1;">
                            Confirm Booking
                        </button>
                        <button class="btn btn-secondary" id="close-modal" style="flex: 1;">
                            Edit Details
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            modal.querySelector('#confirm-booking').addEventListener('click', () => {
                alert('Booking confirmed! A confirmation will be sent shortly.');
                document.body.removeChild(modal);
                elements.editTripBtn.classList.add('hidden');
            });
            
            modal.querySelector('#close-modal').addEventListener('click', () => {
                document.body.removeChild(modal);
                elements.editTripBtn.classList.remove('hidden');
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                    elements.editTripBtn.classList.remove('hidden');
                }
            });
        }

        // Edit trip
        elements.editTripBtn.addEventListener('click', () => {
            // Reset all fields to edit mode
            ['pickup', 'destination', 'datetime'].forEach(field => {
                editField(field);
            });
            
            // Show any existing stops
            const stopInputs = document.querySelectorAll('.stop-input');
            stopInputs.forEach(input => {
                input.parentElement.parentElement.classList.remove('hidden');
            });
            
            // Hide edit button
            elements.editTripBtn.classList.add('hidden');
            
            // Focus on first field
            elements.pickupInput.focus();
        });

        // Prevent auto-close and reset behaviors
        document.addEventListener('DOMContentLoaded', () => {
            // Disable browser autocomplete
            document.querySelectorAll('input').forEach(input => {
                input.autocomplete = 'off';
                input.autocapitalize = 'off';
                input.spellcheck = false;
            });

            // Prevent iOS zoom on focus
            document.addEventListener('touchstart', () => {}, {passive: true});
            
            // Initialize
            initializeDateTime();
            initAutocomplete();
        });

        // Global callback for Google Maps API
        window.initAutocompleteCallback = initAutocomplete;
    </script>
</body>
</html>